<html>
<head>
<title>Test 04: enumerateDevices</title>
</head>

<body>
<h2>Test 04: enumerateDevices</h2>
<canvas id="canvas" width=320 height=240></canvas>
<div id="log"></div>
</body>

<script>
(function () {
    if (!console) {
        console = {};
    }
    var old = console.log;
    var logger = document.getElementById('log');
    console.log = function (message) {
        if (typeof message == 'object') {
            logger.innerHTML += (JSON && JSON.stringify ? JSON.stringify(message) : String(message)) + '<br />';
        } else {
            logger.innerHTML += message + '<br />';
        }
    }
})();

var videoElement = document.querySelector('canvas');

function successCallback(stream) {
    window.stream = stream; // make stream available to console
    videoElement.src = window.URL.createObjectURL(stream);
    videoElement.play();
}

function errorCallback(error) {
    console.log('navigator.getUserMedia error: ', error);
}

navigator.mediaDevices.enumerateDevices().then(
    function(devices) {
        console.log(devices)
        for (var i = 0; i < devices.length; i++) {    
            if (devices[i].kind == 'videoinput' && devices[i].label.indexOf('back') !== -1) {
                if (window.stream) {
                    videoElement.src = null;
                    window.stream.stop();
                }
                var constraints = {
                    video: {
                        optional: [{
                            sourceId: devices[i].deviceId
                        }]
                    }
                };
                navigator.getUserMedia(constraints, successCallback, errorCallback);
                console.log(devices[i])
            }
        }
    }
); 
</script>

</html>